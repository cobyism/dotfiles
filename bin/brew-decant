#!/usr/bin/env zsh

# External subcommand for `brew`:
# Maintains an up-to-date Brewfile in $DOTFILES.

# Paths
local BREWFILE_LOCATION="$HOME/code/dotfiles/Brewfile"
local BREWFILE_RAW="$BREWFILE_LOCATION.raw"
local BREWFILE_SORTED="$BREWFILE_LOCATION.sorted"

# Remove current linkable and home symlink
echo "Refreshing Brewfileâ€¦"
rm -f $BREWFILE_RAW
rm -f $BREWFILE_SORTED
rm -f $BREWFILE_LOCATION

# Regenerate linkable
$(brew bundle dump --all --describe --force --file=$BREWFILE_RAW)

# Sort the Brewfile using the brewfile-sort script
$HOME/code/dotfiles/bin/brewfile-sort $BREWFILE_RAW > $BREWFILE_SORTED

# Link the sorted Brewfile to the global Brewfile location
ln -sf $BREWFILE_SORTED $BREWFILE_LOCATION

# Done!
echo "Ah, that's better!"